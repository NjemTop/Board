FROM python:3.10-alpine

# Устанавливаем SQLite
RUN apk add --no-cache sqlite

# Копируем файлы с классами и миграцией
COPY ./DataBase/model_class.py /app/model_class.py
COPY ./DataBase/manage.py /app/manage.py

# Задаем рабочую директорию
WORKDIR /app/

# Выполняем миграцию БД
RUN python manage.py migrate

# Копируем файл базы данных в новый контейнер
COPY ./DataBase/database.db /var/lib/sqlite/

# Удаляем скопированные файлы
RUN rm /app/model_class.py /app/manage.py

# Добавляем healthcheck
HEALTHCHECK CMD sqlite3 /var/lib/sqlite/database.db "SELECT 1"

# Задаем рабочую директорию
WORKDIR /var/lib/sqlite/

# Устанавливаем точку входа
CMD ["datasette", "serve", "--host", "0.0.0.0", "--port", "5000", "database.db"]
